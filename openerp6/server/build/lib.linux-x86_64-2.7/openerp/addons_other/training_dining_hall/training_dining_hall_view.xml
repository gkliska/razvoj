<?xml version="1.0"?>
<openerp>
    <data>

<!-- training.school -->
        <act_window
            id="training_dining_hall_rule_shortcut"
            name="Dining Rules"
            src_model='training.school'
            res_model='training.dining_hall.rule'
            context='{"active": True}'
            groups="group_dining_hall_manager,group_dining_hall_user"/>


<!--training.dining_hall.rule-->
       <record model="ir.ui.view" id="training_dining_hall_rule_search">
            <field name="name">training.dining_hall.rule.search</field>
            <field name="model">training.dining_hall.rule</field>
            <field name="type">search</field>
            <field name="arch" type="xml">
                <search string="Search Courses">
                   <group col='15' colspan='4'>
                        <filter icon="terp-document-new" name="active" string="Active" domain="[('active','=', True)]"/>
                       <separator orientation="vertical"/>
                       <field name="name" string="Name"/>
                       <field name="school_id" string="School"/>
                   </group>
               </search>
            </field>
        </record>

        <record model="ir.ui.view" id="training_dining_hall_rule_form_view">
            <field name="name">training.dining_hall.rule.form</field>
            <field name="model">training.dining_hall.rule</field>
            <field name="type">form</field>
            <field name="arch" type="xml">
                <form string="Dining Hall Rules">
                    <field name="name"/>
                    <field name="school_id"/>
                    <field name="active"/>
                    <separator string="Threshold for stable price" colspan="4"/>
                    <field name="min_days"/>
                    <field name="num_unit_time"/>
                    <field name="unit_time"/>
                    <notebook colspan="4">
                        <page string="Lines">
                            <field name="line_ids" mode="tree,form" nolabel="1" context="{'default_dining_rule_id': active_id}">
                                <tree string="Lines">
                                    <field name="name"/>
                                    <field name="stable_price"/>
                                    <field name="eventual_price"/>
                                    <field name="picnic_price"/>
                                    <field name="absent_price"/>
                                </tree>
                                <form string="Lines">
                                    <field name="name" colspan="4"/>
                                    <field name="menu_type_ids" colspan="4" nolabel="1"/>
                                    <label string="Before you can insert any product, first you should save this rule line." colspan="4"/>
                                    <group colspan="2">
                                        <field name="stable_ids" colspan="2" nolabel="1" on_change="onchange_rule_line_product_ids(stable_ids)" context="{'default_dining_rule_line_id': active_id, 'default_type': 'stable'}">
                                            <tree string="Stable" editable="bottom">
                                                <field name="product_id"/>
                                                <field name="price"/>
                                                <field name="dining_rule_line_id" invisible="1"/>
                                                <field name="type" invisible="1"/>
                                            </tree>
                                            <form string="Stable">
                                                <field name="product_id"/>
                                                <field name="price"/>
                                                <field name="dining_rule_line_id"/>
                                                <field name="type"/>
                                            </form>
                                        </field>
                                        <newline/>
                                        <field name="stable_price"/>
                                    </group>
                                    <group colspan="2">
                                        <field name="eventual_ids" colspan="2" nolabel="1" on_change="onchange_rule_line_product_ids(eventual_ids)" context="{'default_dining_rule_line_id': active_id, 'default_type': 'eventual'}">
                                            <tree string="Eventual" editable="bottom">
                                                <field name="product_id"/>
                                                <field name="price"/>
                                                <field name="dining_rule_line_id" invisible="1"/>
                                                <field name="type" invisible="1"/>
                                            </tree>
                                            <form string="Stable">
                                                <field name="product_id"/>
                                                <field name="price"/>
                                                <field name="dining_rule_line_id"/>
                                                <field name="type"/>
                                            </form>
                                        </field>
                                        <newline/>
                                        <field name="eventual_price"/>
                                    </group>
                                    <group colspan="2">
                                        <field name="picnic_ids" colspan="2" nolabel="1" on_change="onchange_rule_line_product_ids(picnic_ids)" context="{'default_dining_rule_line_id': active_id, 'default_type': 'picnic'}">
                                            <tree string="Picnic" editable="bottom">
                                                <field name="product_id"/>
                                                <field name="price"/>
                                                <field name="dining_rule_line_id" invisible="1"/>
                                                <field name="type" invisible="1"/>
                                            </tree>
                                            <form string="Stable">
                                                <field name="product_id"/>
                                                <field name="price"/>
                                                <field name="dining_rule_line_id"/>
                                                <field name="type"/>
                                            </form>
                                        </field>
                                        <newline/>
                                        <field name="picnic_price"/>
                                    </group>
                                    <group colspan="2">
                                        <field name="absent_ids" colspan="2" nolabel="1" on_change="onchange_rule_line_product_ids(absent_ids)" context="{'default_dining_rule_line_id': active_id, 'default_type': 'absent'}">
                                            <tree string="Absent" editable="bottom">
                                                <field name="product_id"/>
                                                <field name="price"/>
                                                <field name="dining_rule_line_id" invisible="1"/>
                                                <field name="type" invisible="1"/>
                                            </tree>
                                            <form string="Stable">
                                                <field name="product_id"/>
                                                <field name="price"/>
                                                <field name="dining_rule_line_id"/>
                                                <field name="type"/>
                                            </form>
                                        </field>
                                        <newline/>
                                        <field name="absent_price"/>
                                    </group>
                                </form>
                            </field>
                        </page>
                        <page string="Groups">
                            <field name="group_ids" colspan="4" nolabel="1" widget="many2many"/>
                        </page>
                        <page string="Special Days">
                            <field name="special_day_ids" colspan="4" nolabel="1">
                                <tree string="Special Day Type">
                                    <field name="special_day_type_id"/>
                                    <field name="policy_not_used"/>
                                </tree>
                                <form string="Special Day Type">
                                    <field name="special_day_type_id"/>
                                    <field name="dining_rule_id"/>
                                    <field name="policy_not_used"/>
                                </form>
                            </field>
                        </page>
                    </notebook>
                </form>
            </field>
        </record>

        <record model="ir.ui.view" id="training_dining_hall_rule_tree_view">
            <field name="name">training.dining_hall.rule.tree</field>
            <field name="model">training.dining_hall.rule</field>
            <field name="type">tree</field>
            <field name="arch" type="xml">
                <tree string="Dining Hall Rules">
                    <field name="name"/>
                    <field name="school_id"/>
                    <field name="min_days"/>
                    <field name="num_unit_time"/>
                    <field name="unit_time"/>
                </tree>
            </field>
        </record>

        <record model="ir.actions.act_window" id="training_dining_hall_rule_action">
            <field name="name">Dining Hall Rules</field>
            <field name="res_model">training.dining_hall.rule</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
        </record>


<!-- training.dining_hall.special_day.type -->
        <record model="ir.ui.view" id="training_dining_hall_special_day_type_form_view">
            <field name="name">training.dining_hall.special_day.type.form</field>
            <field name="model">training.dining_hall.special_day.type</field>
            <field name="type">form</field>
            <field name="arch" type="xml">
                <form string="Special Day Type">
                    <field name="name"/>
                </form>
            </field>
        </record>

        <record model="ir.ui.view" id="training_dining_hall_special_day_type_tree_view">
            <field name="name">training.dining_hall.special_day.type.tree</field>
            <field name="model">training.dining_hall.special_day.type</field>
            <field name="type">tree</field>
            <field name="arch" type="xml">
                <tree string="Special Day Type">
                    <field name="name"/>
                </tree>
            </field>
        </record>

        <record model="ir.actions.act_window" id="training_dining_hall_special_day_type_action">
            <field name="name">Special Day Types</field>
            <field name="res_model">training.dining_hall.special_day.type</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
        </record>


<!--training.dining_hall.menu_type-->
        <record model="ir.ui.view" id="training_dining_hall_menu_type_form_view">
            <field name="name">training.dining_hall.menu_type.form</field>
            <field name="model">training.dining_hall.menu_type</field>
            <field name="type">form</field>
            <field name="arch" type="xml">
                <form string="Menu Type">
                    <field name="name"/>
                </form>
            </field>
        </record>

        <record model="ir.ui.view" id="training_dining_hall_menu_type_tree_view">
            <field name="name">training.dining_hall.menu_type.tree</field>
            <field name="model">training.dining_hall.menu_type</field>
            <field name="type">tree</field>
            <field name="arch" type="xml">
                <tree string="Menu Type">
                    <field name="name"/>
                </tree>
            </field>
        </record>

        <record model="ir.actions.act_window" id="training_menu_type_action">
            <field name="name">Menu Types</field>
            <field name="res_model">training.dining_hall.menu_type</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
        </record>


<!-- res.partner.contact -->
        <record model="ir.ui.view" id="res_partner_contact_form_view_inherited_from_multi_school">
            <field name="name">Contact form view inherited from Multi School</field>
            <field name="model">res.partner.contact</field>
		    <field name="inherit_id" ref="training_multi_school.res_partner_contact_training_multi_school_form_view_inherited"/>
            <field name="type">form</field>
            <field name="arch" type="xml">
                <xpath expr="/form/notebook/page[@string='Extra Information']/field[@name='school_id']" position="replace">
                </xpath>
            </field>
        </record>
        <record model="ir.ui.view" id="res_partner_contact_form_view_inherited_from_group">
            <field name="name">Contact form view inherited from Group</field>
            <field name="model">res.partner.contact</field>
		    <field name="inherit_id" ref="training_group.res_partner_contact_form_view_inherited"/>
            <field name="type">form</field>
            <field name="arch" type="xml">
                <xpath expr="/form/notebook/page[@string='Extra Information']/field[@name='group_id']" position="replace">
                </xpath>
            </field>
        </record>
        <record model="ir.ui.view" id="res_partner_contact_form_view_inherited">
            <field name="name">Contact form view inherited</field>
            <field name="model">res.partner.contact</field>
		    <field name="inherit_id" ref="base_contact.view_partner_contact_form"/>
            <field name="type">form</field>
            <field name="arch" type="xml">
                <xpath expr="/form/notebook/page[@string='Extra Information']" position="after">
                    <page string="Dining Hall">
                        <field name="menu_type_id"/>
                        <field name="picnic"/>
                        <field name="school_id" groups="training_multi_school.school_useability_multi_school"/>
                        <field name="group_id"/>
                        <field mode="tree,form" name="weekdays_ids" colspan="4" nolabel="1">
                            <tree editable="bottom" string="The weekdays that the pupil will come to the dining hall">
                                <field name="date_from"/>
                                <field name="date_to"/>
                                <field name="monday"/>
                                <field name="tuesday"/>
                                <field name="wednesday"/>
                                <field name="thursday"/>
                                <field name="friday"/>
                                <field name="saturday"/>
                                <field name="sunday"/>
                                <field name="contact_id" invisible="1"/>
                            </tree>
                            <form>
                                <field name="date_from"/>
                                <field name="date_to"/>
                                <group colspan="4" col="14">
                                    <field name="monday"/>
                                    <field name="tuesday"/>
                                    <field name="wednesday"/>
                                    <field name="thursday"/>
                                    <field name="friday"/>
                                    <field name="saturday"/>
                                    <field name="sunday"/>
                                </group>
                                <field name="contact_id" invisible="1"/>
                            </form>
                        </field>
                        <field mode="form,tree" name="grant_ids" colspan="4" nolabel="1">
                            <tree string="Grants conceded to the contact">
                                <field name="date_from"/>
                                <field name="date_to"/>
                                <field name="monday"/>
                                <field name="tuesday"/>
                                <field name="wednesday"/>
                                <field name="thursday"/>
                                <field name="friday"/>
                                <field name="saturday"/>
                                <field name="sunday"/>
                                <field name="type"/>
                                <field name="grant_amount"/>
                                <field name="contact_id" invisible="1"/>
                            </tree>
                            <form string="Grants conceded to the contact">
                                <field name="date_from"/>
                                <field name="date_to"/>
                                <group colspan="4" col="14" readonly="0">
                                    <field name="monday"/>
                                    <field name="tuesday"/>
                                    <field name="wednesday"/>
                                    <field name="thursday"/>
                                    <field name="friday"/>
                                    <field name="saturday"/>
                                    <field name="sunday"/>
                                </group>
                                <field name="type"/>
                                <group colspan="4">
                                        <field name="valuation" attrs="{'invisible' : [('type', 'in', ['monthly', 'monthly_exceded', 'fixed'])]}" colspan="4"/>
                                        <field name="grant_amount" attrs="{'invisible' : [('type', '=', 'monthly_exceded')]}" colspan="4"/>
                                        <field name="monthly_family_amount" attrs="{'invisible' : [('type', 'in', ['daily', 'monthly'])]}" colspan="4"/>
                                </group>
                                <field name="contact_id" invisible="1"/>
                            </form>
                        </field>
<!--
                        <button type="object" string="Generate Participations" name="generate_participations" icon="terp-camera_test"/>
-->
                    </page>
                </xpath>
            </field>
        </record>

        <act_window
            name="Participations"
            id="contact_participations"
            src_model="res.partner.contact"
            res_model="training.participation"
            domain="[('subscription_line_id.job_id.contact_id', 'in', [active_id])]"
            groups="group_dining_hall_manager,group_dining_hall_user"/>

<!-- training.participation -->
       <record model="ir.ui.view" id="training_participation_inherit_search">
            <field name="name">training.participation.inherit.search</field>
            <field name="model">training.participation</field>
            <field name="type">search</field>
            <field name="arch" type="xml">
                <search string="Search Course">
                    <group col='15' colspan='4'>
<!--                        <field name="group_id" select="1">-->
<!--                            <filter domain="[('group_id', '=', group_id)]" help="Group by groups" icon="terp-personal"/>-->
<!--                        </field>-->
                        <filter icon="terp-personal" string="Group" domain="[]" context="{'group_by' : 'group_id'}"/>
                        <filter icon="terp-go-week" string="Seance" domain="[]" context="{'group_by' : 'seance_id'}"/>
                        <separator orientation="vertical"/>
                        <filter icon="terp-go-today" string="Today" domain="[
                            ('date','&gt;=', time.strftime('%%Y-%%m-%%d 00:00:00')),
                            ('date','&lt;=', time.strftime('%%Y-%%m-%%d 23:59:59'))
                            ]" help="Today participants."/>
                        <filter icon="terp-camera_test" string="Expected Present" context="{'job_search_context': 'show_past'}" domain="[('expected_present','=',1)]" help="Expected Present Participants."/>
                        <filter icon="terp-camera_test" string="Present" context="{'job_search_context': 'show_past'}" domain="[('present','=',1)]" help="Present Participants."/>
                        <filter icon="terp-gtk-stop" string="Absent" context="{'job_search_context': 'show_past'}" domain="[('present','=',0)]" help="Absent participants."/>
                        <separator orientation="vertical"/>
                        <field name="school_id" string="School" groups="training_multi_school.school_useability_multi_school"/>
                        <field name="partner_id" string="Partner"/>
                        <field name="job_id" string="Participant"/>
                        <field name="seance_id" string="Seance"/>
                    </group>
                    <newline/>
                    <group expand="0" string="Extended Filters...">
                        <filter icon="terp-go-today" string="Today-1" name="day-1" domain="[
                            ('date','&gt;',(datetime.date.today()-relativedelta(days=1)).strftime('%%Y-%%m-%%d')),
                            ('date','&lt;',(datetime.date.today()-relativedelta(days=1)).strftime('%%Y-%%m-%%d'))
                            ]" help="Yesterday"/>
                        <filter icon="terp-go-today" string="Today+1" name="day+1" domain="[
                            ('date','&gt;',(datetime.date.today()+relativedelta(days=1)).strftime('%%Y-%%m-%%d')),
                            ('date','&lt;',(datetime.date.today()+relativedelta(days=1)).strftime('%%Y-%%m-%%d'))
                            ]" help="Yesterday"/>
                        <filter icon="terp-go-week" string="Week-1" name="week-1" domain="[
                            ('date','&gt;',(datetime.date.today()-relativedelta(weekday=0)).strftime('%%Y-%%m-%%d')),
                            ('date','&lt;',(datetime.date.today()-relativedelta(weekday=6,weeks=1)).strftime('%%Y-%%m-%%d'))
                            ]" help="Last week"/>
                        <filter icon="terp-go-week" string="Week" name="week" domain="[
                            ('date','&gt;',(datetime.date.today()-relativedelta(weekday=0,weeks=1)).strftime('%%Y-%%m-%%d')),
                            ('date','&lt;',(datetime.date.today()+relativedelta(weekday=6)).strftime('%%Y-%%m-%%d'))
                            ]" help="Last week"/>
                        <filter icon="terp-go-week" string="Week+1" name="week+1" domain="[
                            ('date','&gt;',(datetime.date.today()+relativedelta(weekday=0)).strftime('%%Y-%%m-%%d')),
                            ('date','&lt;',(datetime.date.today()+relativedelta(weekday=6,weeks=1)).strftime('%%Y-%%m-%%d'))
                            ]" help="Last week"/>
                        <filter icon="terp-go-month" string="Month-1" name="month-1" domain="[
                            ('date','&gt;=',(datetime.date.today()-relativedelta(day=1,months=1)).strftime('%%Y-%%m-%%d')),
                            ('date','&lt;=',(datetime.date.today()-relativedelta(day=31,months=1)).strftime('%%Y-%%m-%%d'))
                            ]" help="Last month"/>
                        <filter icon="terp-go-month" string="Month" name="month" domain="[
                            ('date','&gt;=',(datetime.date.today()-relativedelta(day=1)).strftime('%%Y-%%m-%%d')),
                            ('date','&lt;=',(datetime.date.today()+relativedelta(day=31)).strftime('%%Y-%%m-%%d'))
                            ]" help="Current month"/>
                        <filter icon="terp-go-month" string="Month+1" name="month+1" domain="[
                            ('date','&gt;=',(datetime.date.today()+relativedelta(day=1,months=1)).strftime('%%Y-%%m-%%d')),
                            ('date','&lt;=',(datetime.date.today()+relativedelta(day=31,months=1)).strftime('%%Y-%%m-%%d'))
                            ]" help="Last month"/>
                        <newline/>
                        <field name="seance_date" string="Seance Date"/>
                        <field name="contact_id" string="Contact"/>
                        <field name="kind" string="Kind"/>
                    </group>
                    <newline/>
                    <group expand="0" string="Group By...">
                        <filter string="Date" icon="terp-go-month" domain="[]" context="{'group_by':'date'}"/>
                        <separator orientation="vertical"/>
                        <filter string="School" icon="terp-accessories-archiver" domain="[]" context="{'group_by':'school_id'}"/>
                    </group>
               </search>
            </field>
        </record>

        <record model="ir.ui.view" id="training_participation_inherit_form_view">
            <field name="name">training.participation.inherit.form</field>
            <field name="model">training.participation</field>
            <field name="type">form</field>
            <field name="arch" type="xml">
                <form string="Participation">
                    <separator string="Participation Description" colspan="4"/>
                    <field name="job_id"/>
                    <field name="partner_id"/>
                    <field name="seance_id" on_change="on_change_seance(seance_id)"/>
                    <field name="group_id"/>
                    <field name="date"/>
                    <field name="school_id" string="School" groups="training_multi_school.school_useability_multi_school"/>
                    <field name="course_id"/>
                    <newline/>
                    <field name="expected_present"/>
                    <field name="present"/>
                    <notebook colspan="4">
                        <page string="General" groups="base.group_user">
                            <field name="subscription_id"/>
                            <field name="subscription_line_id"/>
                        </page>
                        <page string="Summary" groups="base.group_user">
                            <field name="summary" nolabel="1" colspan="4"/>
                        </page>
                        <page string="Procurements" groups="base.group_user">
                            <field name="purchase_ids" colspan="4" nolabel="1"/>
                            <field name="purchase_state"/>
                        </page>
                    </notebook>
                </form>
            </field>
        </record>

        <record model="ir.ui.view" id="training_participation_inherit_tree_view">
            <field name="name">training.participation.inherit.tree</field>
            <field name="model">training.participation</field>
            <field name="type">tree</field>
            <field name="arch" type="xml">
                <tree string="Participations" editable="bottom">
                    <field name="date"/>
                    <field name="seance_id"/>
                    <field name="course_id"/>
                    <field name="duration"/>
                    <field name="job_id"/>
                    <field name="partner_id" groups="base.group_user"/>
                    <field name="expected_present"/>
                    <field name="present"/>
                    <field name="contact_firstname"/>
                    <field name="contact_lastname"/>
                    <field name="group_id"/>
                    <!--<field name="kind"/>-->
                    <field name="subscription_line_id" groups="base.group_user"/>
                    <field name="school_id" string="School" groups="training_multi_school.school_useability_multi_school"/>
                </tree>
            </field>
        </record>

        <record model="ir.actions.act_window" id="training_dining_hall_participation_action">
            <field name="name">Participations</field>
            <field name="res_model">training.participation</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="domain">[('seance_id.kind', '=', 'dining')]</field>
            <field name="search_view_id" ref="training_participation_inherit_search"/>
	        <field name="context">{'job_search_context': 'show_past'}</field>
        </record>

        <record model="ir.actions.act_window.view" id="training_dining_hall_participation_action_view1">
            <field name="sequence" eval="1"/>
            <field name="view_mode">tree</field>
            <field name="view_id" ref="training_participation_inherit_tree_view"/>
            <field name="act_window_id" ref="training_dining_hall_participation_action"/>
        </record>

        <record model="ir.actions.act_window.view" id="training_dining_hall_participation_action_view2">
            <field name="sequence" eval="2"/>
            <field name="view_mode">form</field>
            <field name="view_id" ref="training_participation_inherit_form_view"/>
            <field name="act_window_id" ref="training_dining_hall_participation_action"/>
        </record>


<!-- training.session -->
       <record id="training_dining_hall_session_search" model="ir.ui.view">
            <field name="name">training.dining.hall.session.search</field>
            <field name="model">training.session</field>
            <field name="type">search</field>
            <field name="arch" type="xml">
                <search string="Session Search">
                    <group col='15' colspan='4'>
                        <filter icon="terp-document-new" string="Draft" domain="[('state','=','draft')]" help="Session State Draft."/>
                        <filter icon="terp-check" string="Opened" domain="[('state','=','opened')]" help="Session State Opened."/>
                        <filter icon="terp-camera_test" string="Confirmed" domain="[('state','=','opened_confirmed')]" help="Session State Confirmed."/>
                        <filter icon="terp-dialog-close" string="Closed Subscription" domain="[('state','=','closed_confirmed')]" help="Session State Closed Subscription."/>
                        <filter icon="terp-tools" string="In Progress" domain="[('state','=','inprogress')]" help="Session State In Progress."/>
                        <filter icon="terp-gtk-stop" string="Closed" domain="[('state','=','closed')]" help="Session State Closed."/>
                        <filter icon="terp-dialog-close" string="Cancelled" domain="[('state','=','cancelled')]" help="Session State Cancelled."/>
                        <separator orientation="vertical"/>
                        <filter icon="terp-gtk-select-all" string="Futures" name="futures" domain="['|', '|', ('date', '>=', current_date), ('date_end', '>=', current_date), ('date_end', '=', False), ('state', '!=', 'closed'), ('state', '!=', 'cancelled')]" help="Futures sessions."/>
                        <separator orientation="vertical"/>
                        <field name="school_id" groups="training_multi_school.school_useability_multi_school"/>
                        <field name="name" string="Name"/>
                        <field name="offer_id" string="Offer"/>
                    </group>
                    <newline/>
                    <group expand="0" string="Extended filters..." groups="base.group_extended" col='15' colspan='4'>
                        <filter icon="terp-personal+" string="Responsible" domain="['|',('user_id', '=', uid)]" help="My responsible sessions." default="1"/>
                        <separator orientation="vertical"/>
                        <field name="catalog_id" string="Catalog"/>
                        <field name="date" string="Date"/>
                        <field name="user_id" string="Responsible"/>
                        <field name="address_id" string="Training place"/>
                        <field name="offer_product_line_id" string="Product Line"/>
                    </group>
                    <newline/>
                    <group expand="0" string="Group by..." groups="base.group_extended" col='15' colspan='4'>
                        <filter icon="terp-document-new" string="Offer" name="Offer" domain = "[]" context="{'group_by':'offer_id'}"/>
                        <separator orientation="vertical"/>
                        <filter string="Catalog" icon="gtk-jump-to" domain="[]" context="{'group_by':'catalog_id'}"/>
                    </group>
                </search>
            </field>
        </record>

        <record model="ir.ui.view" id="training_dining_hall_session_form">
            <field name="name">training.dining.hall.session.form</field>
            <field name="model">training.session</field>
            <field name="type">form</field>
            <field name="priority">2</field>
            <field name="arch" type="xml">
                <form string="Session">
                    <field name="id" invisible="1"/>
                    <field name="name"/>
                    <field name="date" on_change="on_change_date(date, offer_id)"/>
                    <field name="school_id" groups="training_multi_school.school_useability_multi_school"/>
                    <notebook colspan="4">
                        <page string="Session Description">
                            <field name="offer_id" domain="[('can_be_planned', '=', 1)]" on_change="on_change_offer(offer_id)"/>
                            <field name="kind"/>
                            <field name="format_id"/>
                            <field name="catalog_id" groups="training.group_session_user"/>
                            <field name="user_id" groups="training.group_session_user"/>
<!--
                            <field name="stylegroup_id" groups="training.group_session_manager" string="Email Style"/>
-->
                            <field name="address_id"/>
                            <field name="date_end"/>
                            <newline/>
                            <group colspan="4" col="4" groups="training.group_session_user">
                            <separator string="Subscriptions" colspan="4"/>
                            <field name="confirmed_subscriptions"/>
                            <field name="draft_subscriptions"/>
                            <separator string="Overall seats" colspan="4"/>
                            <group colspan="4" col="4">
                                <group attrs="{'invisible' : [('manual', '=', True)]}">
                                    <field name="participant_count"/>
                                </group>
                                <group attrs="{'invisible' : [('manual', '=', False)]}">
                                    <field name="participant_count_manual"/>
                                </group>
                                <field name="manual"/>
                            </group>
                            <field name="available_seats"/>
                            <field name="has_shared_seances"/>
                            <separator string="Thresholds" colspan="4"/>
                            <field name="min_limit"/>
                            <field name="max_limit"/>
                            </group>
                        </page>
                        <page string="Seances">
                            <field name="seance_ids" colspan="4" nolabel="1"
                                context="{'offer_id' : offer_id, 'date' : date}"
                                attrs="{'readonly' : [('state', '!=', 'draft')]}">
                                <tree string="Seances">
                                    <field name="name"/>
                                    <field name="date"/>
                                    <field name="duration" widget="float_time" sum="Total Duration"/>
                                    <field name="state"/>
                                    <field name="duplicata" groups="training.group_seance_user"/>
                                    <field name="group_id"/>
                                    <field name="shared" groups="training.group_seance_user"/>
                                    <field name="contact_names"/>
                                </tree>
                            </field>
                            <button name="dining_hall_create_seances" string="_Create Seances" type="object"
                                icon="gtk-execute" colspan="4" states="draft" groups="training.group_seance_manager"/>
                        </page>
                        <page string="Groups">
                            <field name="group_ids" colspan="4" nolabel='1'>
                                <tree string='Groups'>
                                    <field name="name"/>
                                </tree>
                            </field>
                        </page>
                    </notebook>
                    <group colspan="4" col="3">
                        <field name="state"/>
                        <group col="6" groups="training.group_session_manager">
                            <button name="signal_open" string="Open" type="workflow" states="draft" confirm="Do you want to open this session ?"/>
                            <button name="signal_open_confirm" string="Confirm" type="workflow" states="opened" confirm="Do you want to confirm this session ?"/>
                            <button name="signal_close_confirm" string="Close Subscriptions" type="workflow" states="opened_confirmed" confirm="Do you want to close the subscription for this session ?"/>
                            <button name="signal_inprogress" string="Start" type="workflow" states="closed_confirmed" confirm="Do you want to close this session for the subscription ?"/>
                            <button name="signal_close" string="Close" type="workflow" states="inprogress"  confirm="Do you want to close this session ?"/>
                            <button name="signal_cancel" string="Cancel" type="workflow" states="draft,opened,opened_confirmed,closed_confirmed" confirm="Do you want to cancel this session ?"/>
                        </group>
                    </group>
                </form>
            </field>
        </record>

        <record model="ir.ui.view" id="training_dining_hall_session_tree">
            <field name="name">training.dining.hall.session.tree</field>
            <field name="model">training.session</field>
            <field name="type">tree</field>
            <field name="priority">0</field>
            <field name="arch" type="xml">
                <tree string="Sessions" colors="red:state=='draft';gray:state=='cancelled'">
                    <field name="name"/>
                    <field name="state"/>
                    <field name="date"/>
                    <field name="offer_id"/>
                    <field name="catalog_id"/>
                    <field name="kind"/>
                    <field name="format_id"/>
                    <field name="available_seats" groups="training.group_seance_user"/>
                    <field name="participant_count" groups="training.group_seance_user"/>
                    <field name="draft_subscriptions" groups="training.group_seance_user"/>
                    <field name="confirmed_subscriptions" groups="training.group_seance_user"/>
                    <field name="offer_product_line_id"/>
                    <field name="school_id" groups="training_multi_school.school_useability_multi_school"/>
                </tree>
            </field>
        </record>

        <record model="ir.actions.act_window" id="training_dining_hall_session_action">
            <field name="name">Sessions</field>
            <field name="res_model">training.session</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form,calendar</field>
            <field name="domain">[('kind', '=', 'dining')]</field>
            <field name="context">{"search_default_futures":1}</field>
            <field name="search_view_id" ref="training_dining_hall_session_search"/>        
        </record>

        <record model="ir.actions.act_window.view" id="action_training_dining_hall_session_form1">
            <field name="sequence" eval="1"/>
            <field name="view_mode">tree</field>
            <field name="view_id" ref="training_dining_hall_session_tree"/>
            <field name="act_window_id" ref="training_dining_hall_session_action"/>
        </record>

        <record model="ir.actions.act_window.view" id="action_training_dining_hall_session_form2">
            <field name="sequence" eval="2"/>
            <field name="view_mode">form</field>
            <field name="view_id" ref="training_dining_hall_session_form"/>
            <field name="act_window_id" ref="training_dining_hall_session_action"/>
        </record>

        <act_window
            name="Seances Generator"
            id="training_create_seances_act"
            src_model="training.session"
            res_model="training.create.seances.wizard"
            key2="client_action_multi"
            view_type="form"
            view_mode="form"
            target="new"
            groups="group_dining_hall_manager,group_dining_hall_user"/>
<!--            domain="[('session_ids', 'in', active_ids)]"-->


<!-- training.subscription -->
       <record id="training_dining_hall_subscription_search" model="ir.ui.view">
            <field name="name">training.dining.hall.subscription.search</field>
            <field name="model">training.subscription</field>
            <field name="type">search</field>
            <field name="arch" type="xml">
                <search string="Search Subscription">
                   <group col='15' colspan='4'>
                        <filter icon="terp-document-new" string="To Validate" domain="[('state','=','draft')]" help="Subscription State Draft."/>
                        <filter icon="terp-check" string="To Invoice" domain="[('state','=','confirmed')]" help="Subscription State Confirmed."/>
                        <separator orientation="vertical"/>
                        <filter icon="terp-personal+" string="My Subscriptions" domain="['|',('create_uid', '=', uid)]" help="Suscriptions in which I create." default="1"/>
                        <separator orientation="vertical"/>
                        <field name="school_id" string="School" groups="training_multi_school.school_useability_multi_school"/>
                        <field name="name" string="Reference"/>
                        <field name="partner_id" string="Partner"/>
                   </group>
                   <newline/>
                   <group expand="0" string="Extended Filters...">     
                        <field name="address_id" string="Invoice Address"/>
                        <field name="subscription_line_ids" string="Subscription Lines"/>
                        <field name="responsible_id" string="Creator"/>
                   </group>
                   <newline/>
                   <group expand="0" string="Group By...">                      
                        <filter string="Partner" name="Partner" icon="terp-partner" domain = "[]" context="{'group_by':'partner_id'}"/>
                        <filter string="Responsible" icon="terp-personal" domain="[]" context="{'group_by':'responsible_id'}"/>
                        <separator orientation="vertical"/>
                        <filter string="State" icon="terp-stock_effects-object-colorize" domain="[]" context="{'group_by':'state'}"/>
                        <separator orientation="vertical"/>
                        <filter string="Create Date" icon="terp-go-month" domain="[]" context="{'group_by':'create_date'}"/>
                   </group>
               </search>
            </field>
        </record>

        <record model="ir.ui.view" id="training_dining_hall_subscription_form">
            <field name="name">training.dining.hall.subscription.form</field>
            <field name="model">training.subscription</field>
            <field name="type">form</field>
            <field name="arch" type="xml">
                <form string="subscription">
                    <separator string="Subscription Description" colspan="4"/>
                    <field name="name"/>
                    <field name="create_date"/>
                    <notebook colspan="4">
                        <page string="Subscription">
                            <field name="partner_id" on_change="on_change_partner(partner_id)" attrs="{'readonly' : [('state', '!=', 'draft')]}" groups="base.group_user"/>
                            <field name="pricelist_id" invisible="1"/>
                            <field name="partner_rh_email"/>
                            <field name="address_id" domain="[('partner_id','=', partner_id)]" attrs="{'readonly' : [('state', '!=', 'draft')]}" groups="base.group_user"/>
                            
<!--                        <group colspan="2" col="4" groups="base.group_user">
                                <field name="notification_active" attrs="{'readonly' : [('state', '!=', 'draft')]}"/>
-->
                            <field name="notification_text"/>
<!--
                            </group>
-->
                            <field name="school_id" string="School" groups="training_multi_school.school_useability_multi_school"/>
                            <field name="payment_term_id" attrs="{'readonly' : [('state', '!=', 'draft')]}" groups="base.group_user"/>
                            <field name="subscription_line_ids" colspan="4" nolabel="1"
                                default_get="{'price_list_id': pricelist_id, 'partner_hr_email': partner_rh_email}"
                                context="{'default_price_list_id': pricelist_id, 'default_partner_hr_email': partner_rh_email}"
                                attrs="{'readonly' : [('state', '!=', 'draft')]}">
                                <form string="Subscription Line">
                                    <separator string="General" colspan="4"/>
                                    <field name="name"/>
                                    <field name="partner_hr_email" readonly="1"/>
                                    <field name="job_id"
                                        context="{'partner_id' : parent.partner_id}"
                                        domain="[('name', '=', parent.partner_id)]"
                                        on_change="on_change_job(job_id)"/>
                                    <field name="job_email"/>

                                    <separator string="Session" colspan="4"/>
                                    <field name="session_id"
                                        on_change="on_change_session(session_id, price_list_id, parent.partner_id)"/>
                                    <field name="session_date"/>
                                    <field name="kind"/>
                                    <group colspan="4" col="4" groups="base.group_user">
                                        <separator string="Invoicing" colspan="4"/>
                                    </group>
                                    <field name="price_list_id" on_change="on_change_price_list(session_id, price_list_id)" groups="base.group_user"/>
                                    <field name="price" groups="base.group_user"/>
                                    <group col="5" colspan="4" string="Invoice" groups="base.group_user">
                                        <field name="invoice_id" context="{'form_view_ref': 'account.invoice_form'}"/>
                                        <field name="invoice_line_id"/>
                                        <group col="1" colspan="1">
                                            <group attrs="{'invisible' : [('invoice_line_id', '=', False)]}" col="2" colspan="1">
                                                <field name="paid"/>
                                            </group>
                                            <group states="confirmed,done">
                                                <button name="action_create_invoice" string="Create Invoice" type="object" attrs="{'invisible': [('invoice_line_id', '!=', False)]}" icon="gtk-new"/>
                                            </group>
                                        </group>
                                    </group>
                                    <separator colspan="4"/>
                                    <field name="state" colspan="4"/>
                                </form>
                                <tree string="Subscription Lines">
                                    <field name="name"/>
                                    <field name="session_id"/>
                                    <field name="session_date"/>
                                    <field name="kind"/>
                                    <field name="job_id" domain="[('name', '=', parent.partner_id)]" on_change="on_change_job(job_id)"/>
                                    <field name="price_list_id" groups="base.group_user"/>
                                    <field name="price" sum="Price"/>
                                    <field name="invoice_line_id" widget="boolean" string="Invoiced" groups="base.group_user"/>
                                    <field name="state"/>
                                </tree>
                            </field>
                        </page>
                        <page string="Other Data" groups="base.group_user">
                            <field name="responsible_id"/>
                            <field name="origin" attrs="{'readonly' : [('state', '!=', 'draft')]}"/>
<!--                            <field name="is_from_web" groups="base.group_user"/>-->
                        </page>
                    </notebook>
                    <group colspan="4" col="6">
                        <field name="state"/>
                        <button string="Confirm Request" type="workflow" name="signal_confirm" states="draft" confirm="Do you want to confirm the request for this subscription ?" icon="terp-camera_test"/>
                        <button string="Cancel" type="workflow" name="signal_cancel" states="draft" confirm="Do you want to cancel this subscription ?" icon="gtk-cancel"/>
                    </group>
                </form>
            </field>
        </record>

        <record model="ir.ui.view" id="training_dining_hall_subscription_tree">
            <field name="name">training.dining.hall.subscription.tree</field>
            <field name="model">training.subscription</field>
            <field name="type">tree</field>
            <field name="arch" type="xml">
                <tree string="Subscriptions" colors="black:state == 'done';red:state=='draft';darkgreen:state=='confirmed';gray:state=='cancelled'">
                    <field name="name"/>
                    <field name="state"/>
                    <field name="create_date"/>
                    <field name="partner_id" groups="base.group_user"/>
                    <field name="responsible_id" groups="base.group_user"/>
                    <field name="partner_rh_email"/>
                    <field name="payment_term_id" groups="base.group_user"/>
                    <field name="school_id" groups="training_multi_school.school_useability_multi_school"/>
                </tree>
            </field>
        </record>

        <record model="ir.actions.act_window" id="training_dining_hall_subscription_action">
            <field name="name">Subscriptions</field>
            <field name="context">{'default_partner_id':False}</field>
            <field name="res_model">training.subscription</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="domain">[('subscription_line_ids.kind', '=', 'dining')]</field>
            <field name="search_view_id" ref="training_dining_hall_subscription_search"/> 
        </record>

        <record model="ir.actions.act_window.view" id="training_dining_hall_subscription_action_view1">
            <field name="sequence" eval="1"/>
            <field name="view_mode">tree</field>
            <field name="view_id" ref="training_dining_hall_subscription_tree"/>
            <field name="act_window_id" ref="training_dining_hall_subscription_action"/>
        </record>

        <record model="ir.actions.act_window.view" id="training_dining_hall_subscription_action_view2">
            <field name="sequence" eval="2"/>
            <field name="view_mode">form</field>
            <field name="view_id" ref="training_dining_hall_subscription_form"/>
            <field name="act_window_id" ref="training_dining_hall_subscription_action"/>
        </record>

        <record model="ir.actions.act_window" id="training_dining_hall_subscription_new_act">
            <field name="name">New Subscription</field>
            <field name="context">{'default_partner_id':False, 'default_address_id': False}</field>
            <field name="res_model">training.subscription</field>
            <field name="view_type">form</field>
            <field name="view_mode">form</field>
        </record>

<!--        <act_window name="Subscription Lines To Confirm"-->
<!--            groups='base.group_user'-->
<!--            src_model="training.dining.hall.subscription"-->
<!--            res_model="training.dining.hall.subscription.line"-->
<!--            domain="[('subscription_id', '=', active_id),('state', '=', 'draft'), ('subscription_state', '=', 'confirmed')]"-->
<!--            id="act_window_subscription_line_to_confirm"/>-->

<!--        <act_window name="All Subscription Lines"-->
<!--            groups='base.group_user'-->
<!--            src_model="training.dining.hall.subscription"-->
<!--            res_model="training.dining.hall.subscription.line"-->
<!--            domain="[('subscription_id', '=', active_id)]"-->
<!--            id="act_window_subscription_line_related"/>-->

<!--        <act_window name="Sessions"-->
<!--            groups='base.group_user'-->
<!--            src_model="training.dining.hall.subscription"-->
<!--            res_model="training.session"-->
<!--            context="{'subscription_id' : active_id}"-->
<!--            id="act_window_session_from_dining_hall_subscription"/>-->


<!-- training.subscription.line -->
       <record id="training_dining_hall_subscription_line_search" model="ir.ui.view">
            <field name="name">training.dining.hall.subscription.line.search</field>
            <field name="model">training.subscription.line</field>
            <field name="type">search</field>
            <field name="arch" type="xml">
                <search string="Search Subscription Line">
                    <group col='15' colspan='4'>
                        <filter icon="terp-document-new" string="Draft" domain="[('state', '=', 'draft')]" help="Subscription lines in draft state."/>
                        <filter icon="terp-camera_test" string="Confirmed" domain="[('state', '=', 'confirmed')]" help="Subscription lines in confirmed state."/>
                        <separator orientation="vertical"/>
                        <filter icon="terp-camera_test" string="To Validate" domain="[('state', '=', 'draft'), ('subscription_id.state', '=', 'confirmed')]" help="Subscription Line State To Validate."/>
                        <filter icon="terp-check" string="To Invoice" domain="[('invoice_line_id', '=', False),('state', 'in', ('done','confirmed')),('subscription_id.state', 'in', ('confirmed', 'done')), ('session_id.state', 'not in', ['cancelled', 'draft']),('price','!=',0)]" help="Subscription Line State To Invoice."/>
                        <filter icon="terp-emblem-important" string="To Fix" domain="[('session_id.date', '&lt;', (datetime.datetime.today()+datetime.timedelta(days=1)).strftime('%%Y-%%m-%%d 23:59:59')),('session_id.state','in',['inprogress','closed'])]" help="Subscription Line State To Fix."/>
                        <separator orientation="vertical"/>
                        <field name="school_id" string="School" groups="training_multi_school.school_useability_multi_school"/>
                        <field name="name" string="Reference"/>
                        <field name="partner_id" string="Partner"/>
                    </group>
                    <newline/>
                    <group expand="0" string="Extended Filters...">
                        <field name="create_uid" string="Created by"/>
                        <field name="subscription_state" string="State"/>
                        <field name="offer_id" string="Offer"/>
                        <field name="offer_product_line_id" string="Product Line"/>
                        <field name="job_id" string="Participant"/>
                        <field name="contact_id" string="Contact"/>
                        <field name="kind" string="Kind"/>
                        <newline/>
                        <field name="validation_uid" string="Validated by"/>
                        <field name="cancellation_uid" string="Cancelled by"/>
                        <field name="session_state" string="Session State"/>
                        <field name="session_date" string="Session Date"/>
                        <field name="has_certificate" string="Has Certificate"/>
                    </group>
                    <newline/>
                    <group expand="0" string="Group By...">
                        <filter string="Partner" icon="terp-partner" domain="[]" context="{'group_by':'session_id'}"/>
                        <separator orientation="vertical"/>
                        <filter string="State" icon="terp-stock_effects-object-colorize" domain="[]" context="{'group_by':'state'}"/>
                        <separator orientation="vertical"/>
                        <filter string="Create Date" icon="terp-go-month" domain="[]" context="{'group_by':'create_date'}"/>
                    </group>
               </search>
            </field>
        </record>

        <record model="ir.ui.view" id="training_dining_hall_subscription_line_form">
            <field name="name">training.dining.hall.subscription.line.form</field>
            <field name="model">training.subscription.line</field>
            <field name="type">form</field>
            <field name="arch" type="xml">
                <form string="Subscription Line">
                    <field name="name"/>
                    <field name="subscription_id" on_change="on_change_subscription(subscription_id)" attrs="{'readonly':[('state', '!=', 'draft')]}"/>
                    <field name="partner_id"/>
                    <field name="partner_hr_email" readonly="1"/>
                    <field name="job_id" context="{'partner_id': partner_id}" domain="[('name', '=', partner_id)]" on_change="on_change_job(job_id)" attrs="{'readonly':[('state', '!=', 'draft')]}"/>
                    <field name="job_email" attrs="{'readonly':[('state', '!=', 'draft')]}"/>
                    <notebook colspan="4">
                        <page string="General">
                            <separator string="School" colspan="4"/>
                            <field name="school_id" string="School" colspan="4" groups="training_multi_school.school_useability_multi_school"/>
                            <separator string="Session" colspan="4"/>
                            <field name="session_id" on_change="on_change_session(session_id, price_list_id, partner_id)" attrs="{'readonly':[('state', '!=', 'draft')]}"/>
                            <field name="kind"/>
                            <separator string="Invoicing" colspan="4"/>
                            <group groups="training.group_training" colspan="2" col="2">
                                <field name="price_list_id" on_change="on_change_price_list(session_id, price_list_id)" attrs="{'readonly':[('state', '!=', 'draft')]}"/>
                            </group>
                            <field name="price" attrs="{'readonly':[('state', '!=', 'draft')]}"/>
                            <group col="5" colspan="4" groups="training.group_training">
                                <field name="invoice_id" context="{'form_view_ref': 'account.invoice_form'}"/>
                                <field name="invoice_line_id"/>
                                <group col="1" colspan="1">
                                    <group attrs="{'invisible' : [('invoice_line_id', '=', False)]}" col="2" colspan="1">
                                        <field name="paid"/>
                                    </group>
                                    <group states="confirmed,done" groups="training.group_training">
                                        <button name="action_create_invoice" string="Create Invoice" type="object" icon="gtk-new" attrs="{'invisible': [('invoice_line_id', '!=', False)]}"/>
                                    </group>
                                </group>
                            </group>
                            <group colspan="4" groups="training.group_training">
                                <separator string="Internal Note" colspan="4"/>
                                <field name="internal_note" colspan="4" nolabel="1"/>
                            </group>
                        </page>
                        <page string="History" groups="training.group_subscription_manager">
                            <field name="create_uid"/>
                            <field name="create_date"/>
                            <field name="validation_uid"/>
                            <field name="validation_date"/>
                            <field name="cancellation_uid"/>
                            <field name="cancellation_date"/>
                            <group attrs="{'invisible':[('state', '!=', 'cancelled')]}" colspan="4" col="4">
                                <separator string="Reason of Cancellation" colspan="4"/>
                                <field name="has_certificate"/>
                                <field name="reason_cancellation" nolabel="1" colspan="4"/>
                            </group>
                        </page>
                        <page string="Email" groups="training.group_subscription_manager">
                            <separator string="Email Notifcation Extra Text"/>
                            <field name="email_note" nolabel="1" colspan="4"/>
                        </page>
                    </notebook>
                    <separator colspan="4"/>
                    <group col="9" colspan="4">
                        <field name="state"/>
                        <button name="signal_confirm" string="Confirm" type="workflow" states="draft" confirm="Do you want to confirm this subscription line ?" icon="terp-camera_test"/>
                        <button name="signal_cancel" string="Cancel" type="workflow" states="draft" confirm="Do you want to cancel this subscription line ?" icon="gtk-cancel"/>
                        <button name="signal_invoice_and_send_emails" string="Cancel (Penalities)" type="workflow" states="confirmed" confirm="Do you want to cancel this subscription line ?" icon="gtk-cancel"/>
                        <button name="%(training.subscription_cancellation_wizard_act)d" string="Cancel (Free)" type="action" groups="training.group_subscription_manager" states="confirmed" context="{'default_state':'cancellation'}" confirm="Do you want to cancel this subscription line ?" icon="gtk-cancel"/>
                        <button name="%(training.subscription_cancellation_wizard_act)d" string="Replacement" type="action" states="confirmed" groups="training.group_subscription_manager" context="{'default_state':'replacement'}" confirm="Do you want to do a replacement for this subscription line ?" icon="terp-stock_effects-object-colorize"/>
                        <button name="%(training.subscription_cancellation_wizard_act)d" string="Postponement" type="action" states="confirmed" groups="training.group_subscription_manager" context="{'default_state':'postponement'}" confirm="Do you want to postpone this subscription line ?" icon="terp-stock_effects-object-colorize"/>
                        <button name="signal_done" string="Done" type="workflow" states="confirmed" icon="terp-camera_test"/>
                    </group>
                </form>
            </field>
        </record>

        <record model="ir.ui.view" id="training_dining_hall_subscription_line_tree">
            <field name="name">training.dining.hall.subscription.line.tree</field>
            <field name="model">training.subscription.line</field>
            <field name="type">tree</field>
            <field name="arch" type="xml">
                <tree string="Subscription Lines" colors="black:state == 'done';red:state=='draft';darkgreen:state=='confirmed';gray:state=='cancelled'">
                    <field name="name"/>
                    <field name="state"/>
                    <field name="session_id"/>
                    <field name="session_state"/>
                    <field name="session_date"/>
                    <field name="kind"/>
                    <field name="partner_id" groups="base.group_user"/>
                    <field name="price_list_id" groups="base.group_user"/>
                    <field name="partner_hr_email" groups="base.group_user"/>
                    <field name="contact_lastname"/>
                    <field name="contact_firstname"/>
                    <field name="job_email"/>
                    <field name="notification_text" groups="base.group_user"/>
                    <field name="price"/>
                    <field name="max_limit" groups="base.group_user"/>
                    <field name="confirmed_subscriptions" groups="base.group_user"/>
                    <field name="available_seats" groups="base.group_user"/>
                    <field name="draft_subscriptions" groups="base.group_user"/>
                    <field name="theoritical_disponibility" groups="base.group_user"/>
                    <field name="create_date" groups="base.group_user"/>
                    <field name="validation_date" groups="base.group_user"/>
                    <field name="invoice_line_id" groups="base.group_user"/>
                    <field name="has_certificate" groups="base.group_user"/>
                    <field name="offer_product_line_id" groups="base.group_user"/>
                    <field name="school_id" groups="training_multi_school.school_useability_multi_school"/>
                </tree>
            </field>
        </record>

        <record model="ir.actions.act_window" id="training_dining_hall_subscription_line_action">
            <field name="name">Subscription Lines</field>
            <field name="res_model">training.subscription.line</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="domain">[('kind', '=', 'dining')]</field>
            <field name="search_view_id" ref="training_dining_hall_subscription_line_search"/> 
        </record>

        <record model="ir.actions.act_window.view" id="training_dining_hall_subscription_line_action_view1">
            <field name="sequence" eval="1"/>
            <field name="view_mode">tree</field>
            <field name="view_id" ref="training_dining_hall_subscription_line_tree"/>
            <field name="act_window_id" ref="training_dining_hall_subscription_line_action"/>
        </record>

        <record model="ir.actions.act_window.view" id="training_dining_hall_subscription_line_action_view2">
            <field name="sequence" eval="2"/>
            <field name="view_mode">form</field>
            <field name="view_id" ref="training_dining_hall_subscription_line_form"/>
            <field name="act_window_id" ref="training_dining_hall_subscription_line_action"/>
        </record>


<!-- training.seance -->
       <record model="ir.ui.view" id="training_dining_hall_seance_search">
            <field name="name">training.dining.hall.seance.search</field>
            <field name="model">training.seance</field>
            <field name="type">search</field>
            <field name="arch" type="xml">
                <search string="Seance Search">
                    <group col='15' colspan='4'>
                        <filter icon="terp-document-new" string="Opened" domain="[('state','=','opened')]" help="Seance in state Opened."/>
                        <filter icon="terp-camera_test" string="Confirmed" domain="[('state','=','confirmed')]" help="Seance in state Confirmed."/>
                        <filter icon="terp-mail-forward" string="In Progress" domain="[('state','=','inprogress')]" help="Seance in state In Progress."/>
                        <filter icon="terp-dialog-close" string="Closed" domain="[('state','=','closed')]" help="Seance in state Closed."/>
                        <filter icon="terp-gtk-stop" string="Cancelled" domain="[('state','=','cancelled')]" help="Seance in state Cancelled."/>
                        <filter icon="terp-check" string="Done" domain="[('state','=','done')]" help="Seance in state Done."/>
                        <separator orientation="vertical"/>
                        <filter icon="terp-gtk-select-all" string="Future" name="future" domain="[('date', '>=', current_date),('state', '!=', 'closed'),('state', '!=', 'cancelled')]" help="Seance in state draft."/>
                        <separator orientation="vertical"/>
                        <field name="school_id" string="School" groups="training_multi_school.school_useability_multi_school"/>
                        <field name="name" string="Name"/>
                        <field name="original_offer_id" string="Offer"/>
                        <field name="session_ids" string="Session"/>
                    </group>
                    <newline/>
                    <group expand="0" string="Group By...">
                        <filter string="Group" icon="terp-gtk-jump-to-rtl" domain="[]" context="{'group_by':'group_id'}"/>
                        <separator orientation="vertical"/>
                        <filter string="Date" icon="terp-go-month" domain="[]" context="{'group_by':'date'}"/>
                    </group>
                    <newline/>
                    <group expand="0" string="Extended filters..." groups="base.group_extended" col='15' colspan='4'>
                        <field name="date" string="Date"/>
                        <field name="duration" string="Duration"/>
                        <field name="state" string="State"/>
                        <newline/>
                        <field name="course_id" string="Course"/>
                        <field name="user_id" string="Responsible"/>
                        <field name="confirmed_lecturer" string="Confirmed Lecturer"/>
                        <field name="kind" string="Kind"/>
                        <field name="is_first_seance" string="First Seance"/>
                    </group>
                </search>
            </field>
        </record>

        <record model="ir.ui.view" id="training_dining_hall_seance_form">
            <field name="name">training.dining.hall.seance.form</field>
            <field name="model">training.seance</field>
            <field name="type">form</field>
            <field name="arch" type="xml">
                <form string="Seance">
                    <field name="name"/>
                    <field name="date" on_change="on_change_date(date)"/>
                    <field name="kind"/>
                    <field name="group_id" groups="base.group_user"/>
                    <field name="duplicata" invisible="1"/>
                    <field name="duration" widget="float_time"/>
                    <field name="school_id" string="School" groups="training_multi_school.school_useability_multi_school"/>
                    <notebook colspan="4">
                        <page string="Seance Description">
                            <separator string="Course Information" colspan="4"/>
                            <field name="course_id" on_change="on_change_course(course_id, kind)" attrs="{'readonly' : [('state', '!=', 'opened')]} "/>
                            <field name="state_course" groups="training.group_seance_manager"/>
                            <group col="4" colspan="4" groups="training.group_seance_user">
                                <separator string="Seats" colspan="4"/>
                                <field name="available_seats" groups="training.group_seance_manager"/>
                                <field name="draft_seats" groups="training.group_seance_manager"/>
                                <group colspan="4" col="4">
                                    <group attrs="{'invisible' : [('manual', '=', True)]}">
                                        <field name="participant_count"/>
                                    </group>
                                    <group attrs="{'invisible' : [('manual', '=', False)]}">
                                        <field name="participant_count_manual"/>
                                    </group>
                                    <field name="manual"/>
                                </group>
                                <separator string="Thresholds" colspan="4"/>
                                <field name="min_limit"/>
                                <field name="max_limit"/>
                                <separator string="Responsible" colspan="4"/>
                                <field name="user_id"/>
                            </group>
                        </page>
                        <page string="Linked Sessions" groups="training.group_seance_user">
                            <separator string="Linked Sessions" colspan="4"/>
                            <field name="session_ids"
                                colspan="4"
                                nolabel="1"
                                domain="[('state', '=', 'draft'),('offer_id.course_ids', '=', [course_id])]"
                                attrs="{'readonly' : ['|',('state', '!=', 'opened'),('course_id', '=', False)]}"  groups="base.group_user">
                                <tree string="Linked Sessions">
                                    <field name="name"/>
                                    <field name="state"/>
                                    <field name="offer_id"/>
                                    <field name="catalog_id"/>
                                    <field name="kind"/>
                                </tree>
                            </field>
                        </page>
                        <page string="Lecturers" groups="training.group_seance_manager,training.group_seance_user">
                            <field name="forced_lecturer"/>
                            <field name="contact_ids" nolabel="1" colspan="4" string="Lecturers">
                                <tree string="Lecturers">
                                    <field name="request_id"/>
                                    <field name="job_id"/>
                                    <field name="state"/>
                                </tree>
                            </field>
                        </page>
                        <page string="Participants">
                            <field name="presence_form" groups="training.group_seance_user"/>
                            <field name="participant_ids" colspan="4" nolabel="1" context="{'default_seance_id' : active_id}">
                                <tree string="Participants" editable="bottom">
                                    <field name="partner_id"/>
                                    <field name="contact_lastname"/>
                                    <field name="contact_firstname"/>
                                    <field name="expected_present"/>
                                    <field name="present"/>
                                </tree>
                                <form string="Participation">
                                    <separator string="Participation Description" colspan="4"/>
                                    <field name="job_id"/>
                                    <field name="partner_id"/>
                                    <field name="seance_id" on_change="on_change_seance(seance_id)"/>
                                    <field name="group_id"/>
                                    <field name="date"/>
                                    <field name="course_id"/>
                                    <field name="expected_present"/>
                                    <field name="present"/>
                                    <notebook colspan="4">
                                        <page string="General" groups="base.group_user">
                                            <field name="subscription_id"/>
                                            <field name="subscription_line_id"/>
                                        </page>
                                        <page string="Summary" groups="base.group_user">
                                            <field name="summary" nolabel="1" colspan="4"/>
                                        </page>
                                        <page string="Procurements" groups="base.group_user">
                                            <field name="purchase_ids" colspan="4" nolabel="1"/>
                                            <field name="purchase_state"/>
                                        </page>
                                    </notebook>
                                </form>
                            </field>
                        </page>
                        <page string="Procurements" groups="training.group_seance_user">
                            <field name="purchase_line_ids" nolabel="1" colspan="4" attrs="{'readonly' : [('state', '!=', 'opened')]}">
                                <form string="Procurement">
                                    <field name="auto_update"/>
                                    <separator string="Automatic Declaration" colspan="4"/>
                                    <field name="course_id" colspan="4"/>
                                    <field name="product_id" on_change="on_change_product(product_id)" colspan="4"/>
                                    <field name="product_qty" on_change="on_change_product_qty(product_qty, fix, parent.manual, parent.participant_count_manual, parent.participant_count)"/>
                                    <field name="product_uom"/>
                                    <separator string="Manual Description" colspan="4"/>
                                    <field name="description" colspan="4"/>
                                    <field name="product_price"/>
                                    <field name="fix"/>
                                    <field name="attachment_id" domain="[('is_support', '=', 1),('res_model', '=', 'training.course'),('res_id', '=', parent.course_id)]"/>
                                    <field name="proc_qty"/>
                                    <field name="procurement_id" invisible="1"/>
                                </form>
                                <tree string="Procurements" editable="bottom">
                                    <field name="course_id"/>
                                    <field name="product_id" on_change="on_change_product(product_id)"/>
                                    <field name="description"/>
                                    <field name="product_qty" on_change="on_change_product_qty(product_qty, fix, parent.manual, parent.participant_count_manual, parent.participant_count)"/>
                                    <field name="product_uom"/>
                                    <field name="product_price"/>
                                    <field name="fix"/>
                                    <field name="attachment_id" domain="[('is_support', '=', 1),('res_model', '=', 'training.course'),('res_id', '=', parent.course_id)]"/>
                                    <field name="proc_qty"/>
                                    <field name="procurement_id" invisible="1"/>
                                    <field name="auto_update"/>
                                </tree>
                            </field>
                        </page>
                    </notebook>
                    <group colspan="4" col="3">
                        <field name="state"/>
                        <group col="5" groups="training.group_seance_manager">
                        <button name="seance_confirm" string="Confirm" type="workflow" states="opened" confirm="Do you want to confirm this seance (procurements, ...) ?"/>
                        <button name="signal_inprogress" string="Start" type="workflow" states="confirmed" confirm="Do you want to start this seance ?"/>
                        <button name="signal_close" string="Close" type="workflow" states="inprogress" confirm="Do you want to close this seance ?"/>
                        <button name="signal_cancel" string="Cancel" type="workflow" states="opened,confirmed"  confirm="Do you want to cancel this seance ?"/>
                        <button name="signal_seance_done" string="Done" type="workflow" states="closed"/>
                        </group>
                    </group>
                    <button name="%(training.seance_generate_zip_wizard_act)d" type="action" string="Generate Reports" colspan="4" groups="training.group_training"/>
                </form>
            </field>
        </record>

        <act_window
            name="Attachments"
            id="training_dining_hall_seance_attachment"
            src_model="training.seance"
            res_model="ir.attachment"
            domain="[('res_id', '=', active_id)]"
            groups="base.group_user,group_dining_hall_manager,group_dining_hall_user"/>

        <act_window
            name="Lecturer Participations"
            id="seance_participation_stakeholders"
            src_model="training.seance"
            res_model="training.participation.stakeholder"
            domain="[('seance_id', '=', active_id)]"
            groups="base.group_user,group_dining_hall_manager,group_dining_hall_user"/>

        <act_window
            name="Participants"
            id="seance_participations"
            src_model="training.seance"
            res_model="training.participation"
            domain="[('seance_id', '=', active_id)]"
            groups="base.group_user,group_dining_hall_manager,group_dining_hall_user"/>

        <act_window
            name="Linked Sessions"
            id="seance_sessions"
            src_model="training.seance"
            res_model="training.session"
            domain="[('seance_ids', 'in', [active_id])]"
            groups="base.group_user,group_dining_hall_manager,group_dining_hall_user"/>

        <act_window
            name="Purchase Orders"
            id="seance_purchase_orders_rel"
            src_model="training.seance"
            res_model="purchase.order"
            domain="[('seance_id','=',active_id)]"
            groups="base.group_user,group_dining_hall_manager,group_dining_hall_user"/>

        <record model="ir.ui.view" id="training_dining_hall_seance_tree">
            <field name="name">training.dining.hall.seance.tree</field>
            <field name="model">training.seance</field>
            <field name="type">tree</field>
            <field name="arch" type="xml">
                <tree string="Seances"  colors="blue:state=='opened';darkgreen:state=='confirmed';darkgreen:state=='inprogress';gray:state=='cancelled'">
                    <field name="name"/>
                    <field name="state"/>
                    <field name="date"/>
                    <field name="duration" widget="float_time"/>
                    <field name="original_offer_id"/>
		            <field name="original_offer_kind"/>
                    <field name="state_course"/>
                    <field name="group_id"/>
                    <field name="participant_count"/>
                    <field name="available_seats"/>
                    <field name="draft_seats"/>
                    <field name="confirmed_lecturer"/>
                    <field name="contact_names"/>
                    <field name="presence_form"/>
                    <field name="is_first_seance"/>
                    <field name="school_id" string="School" groups="training_multi_school.school_useability_multi_school"/>
                </tree>
            </field>
        </record>

        <record model="ir.ui.view" id="training_dining_hall_seance_calendar">
            <field name="name">training.dining.hall.seance.calendar</field>
            <field name="model">training.seance</field>
            <field name="type">calendar</field>
            <field name="arch" type="xml">
                <calendar string="Seances" date_start="date" color="kind">
                    <field name="name"/>
                    <field name="group_id"/>
                    <field name="date"/>
                    <field name="duration" widget="float_time"/>
                    <field name="state"/>
                </calendar>
            </field>
        </record>
        
        <record model="ir.actions.act_window" id="training_dining_hall_seance_action">
            <field name="name">Seances</field>
            <field name="res_model">training.seance</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form,calendar</field>
            <field name="domain">[('kind', '=', 'dining')]</field>
            <field name="context">{"search_default_future":1}</field>
        </record>

        <record model="ir.actions.act_window" id="training_dining_hall_seance_planning_act">
            <field name="name">Calendar of Seances</field>
            <field name="res_model">training.seance</field>
            <field name="view_type">form</field>
            <field name="view_mode">calendar</field>
        </record>

        <record model="ir.actions.act_window.view" id="training_dining_hall_seance_action_view1">
            <field name="sequence" eval="1"/>
            <field name="view_mode">tree</field>
            <field name="view_id" ref="training_dining_hall_seance_tree"/>
            <field name="act_window_id" ref="training_dining_hall_seance_action"/>
        </record>

        <record model="ir.actions.act_window.view" id="training_dining_hall_seance_action_view2">
            <field name="sequence" eval="2"/>
            <field name="view_mode">form</field>
            <field name="view_id" ref="training_dining_hall_seance_form"/>
            <field name="act_window_id" ref="training_dining_hall_seance_action"/>
        </record>

        <record model="ir.actions.act_window.view" id="training_dining_hall_seance_action_view3">
            <field name="sequence" eval="3"/>
            <field name="view_mode">calendar</field>
            <field name="view_id" ref="training_dining_hall_seance_calendar"/>
            <field name="act_window_id" ref="training_dining_hall_seance_action"/>
        </record>


<!-- training.group -->
        <record model="ir.ui.view" id="training_dining_hall_group_form">
            <field name="name">training.group.form</field>
            <field name="model">training.group</field>
            <field name="type">form</field>
            <field name="arch" type="xml">
                <form string="Group">
                    <separator string="Information" colspan="4"/>
                    <field name="name"/>
                    <field name="parent_id"/>
                    <field name="session_id" required="1"/>
                    <field name="school_id" string="School" groups="training_multi_school.school_useability_multi_school"/>
                    <field name="generate_seances"/>
                    <separator string="Seances" colspan="4"/>
                    <field name="seance_ids" colspan="4" nolabel="1"/>
                </form>
            </field>
        </record>

        <record model="ir.ui.view" id="training_dining_hall_group_tree">
            <field name="name">training.group.tree</field>
            <field name="model">training.group</field>
            <field name="type">tree</field>
            <field name="arch" type="xml">
                <tree string="Groups">
                    <field name="name"/>
                    <field name="parent_id"/>
                    <field name="school_id" string="School" groups="training_multi_school.school_useability_multi_school"/>
                    <field name="session_id"/>
                    <field name="generate_seances"/>
                </tree>
            </field>
        </record>

        <record model="ir.actions.act_window" id="training_dining_hall_group_action">
            <field name="name">Groups</field>
            <field name="res_model">training.group</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="domain">[('session_id.kind', '=', 'dining')]</field>
        </record>

        <record model="ir.actions.act_window.view" id="training_dining_hall_group_action_view1">
            <field name="sequence" eval="1"/>
            <field name="view_mode">tree</field>
            <field name="view_id" ref="training_dining_hall_group_tree"/>
            <field name="act_window_id" ref="training_dining_hall_group_action"/>
        </record>

        <record model="ir.actions.act_window.view" id="training_dining_hall_group_action_view2">
            <field name="sequence" eval="2"/>
            <field name="view_mode">form</field>
            <field name="view_id" ref="training_dining_hall_group_form"/>
            <field name="act_window_id" ref="training_dining_hall_group_action"/>
        </record>

<!-- training.course -->
        <record model="ir.actions.act_window" id="training_dining_hall_courses_action">
            <field name="name">Courses</field>
            <field name="res_model">training.course</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="domain">[('kind', '=', 'dining')]</field>
        </record>


<!-- training.offer -->
        <record model="ir.actions.act_window" id="training_dining_hall_offers_action">
            <field name="name">Offers</field>
            <field name="res_model">training.offer</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="domain">[('kind', '=', 'dining')]</field>
        </record>


<!--Menu Items-->
    <menuitem
        icon="terp-go-home"
        name="Dining Hall"
        id="training_dining_hall_main_menu"
        sequence="1"
        groups="group_dining_hall_view,group_dining_hall_user,group_dining_hall_manager"
        web_icon="images/training.png"
        web_icon_hover="images/training-hover.png"/>
        <menuitem
            name="Address Book"
            id="training_dining_hall_menu_address_book"
            parent="training_dining_hall_main_menu"
            sequence="5"/>
            <menuitem
                name="Partners"
                id="training_dining_hall_menu_partner_form"
                action="base.action_partner_form"
                parent="training_dining_hall_menu_address_book"/>
            <menuitem
                name="Contacts"
                id="training_dining_hall_menu_partner_contact_form"
                action="base_contact.action_partner_contact_form"
                parent="training_dining_hall_menu_address_book"/>
            <menuitem
                name="Addresses"
                id="training_dining_hall_menu_partner_address_form"
                action="base.action_partner_address_form"
                parent="training_dining_hall_menu_address_book"
                groups="base.group_extended"/>
        <menuitem
            name="Sessions"
            id="training_dining_hall_session_menu"
            action="training_dining_hall_session_action"
            parent="training_dining_hall_main_menu"
            sequence="10"/>
        <menuitem
            name="Seances"
            id="training_dining_hall_seance_menu"
            action="training_dining_hall_seance_action"
            parent="training_dining_hall_main_menu"
            sequence="10"/>
        <menuitem
            name="Participations"
            id="training_dining_hall_participation_menu"
            action="training_dining_hall_participation_action"
            parent="training_dining_hall_main_menu"
            sequence="10"/>
        <menuitem
            name="Subscriptions"
            id="training_dining_hall_subscription_menu"
            action="training_dining_hall_subscription_action"
            parent="training_dining_hall_main_menu"
            sequence="10"/>
        <menuitem
            name="Subscription Lines"
            id="training_dining_hall_subscription_line_menu"
            action="training_dining_hall_subscription_line_action"
            parent="training_dining_hall_main_menu"/>
        <menuitem
            name="Groups"
            id="training_dining_hall_group_menu"
            action="training_dining_hall_group_action"
            parent="training_dining_hall_main_menu"
            sequence="10"/>
        <menuitem
            name="Configuration"
            id="training_dining_hall_config_menu"
            parent="training_dining_hall_main_menu"
            groups="group_dining_hall_manager"
            sequence="15"/>
            <menuitem
                name="Menu types"
                id="training_menu_type_menu"
                action="training_menu_type_action"
                parent="training_dining_hall_config_menu"/>
            <menuitem
                name="Special Day Types"
                id="training_special_day_type_menu"
                action="training_dining_hall_special_day_type_action"
                parent="training_dining_hall_config_menu"/>
            <menuitem
                name="Dining Hall Rules"
                id="training_dining_hall_rule_menu"
                action="training_dining_hall_rule_action"
                parent="training_dining_hall_config_menu"/>
            <menuitem
                name="Offers"
                id="training_dining_hall_offers_menu"
                action="training_dining_hall_offers_action"
                parent="training_dining_hall_config_menu"/>
            <menuitem
                name="Courses"
                id="training_dining_hall_courses_menu"
                action="training_dining_hall_courses_action"
                parent="training_dining_hall_config_menu"/>
            <menuitem
                name="Educational school"
                id="training_dining_hall_school_menu"
                action="training_multi_school.multi_school_action"
                parent="training_dining_hall_config_menu"/>
            <menuitem
                name="Non-Working Days"
                id="training_dining_hall_hollidays_menu"
                parent="training_dining_hall_config_menu"
                sequence='20'/>
                <menuitem
                    id="holiday_dining_hall_period_all_menu"
                    action="training.holiday_period_all_act"
                    parent="training_dining_hall_hollidays_menu"/>
                <menuitem
                    id="training_dining_hall_holiday_year_all_menu"
                    action="training.holiday_year_all_act"
                    parent="training_dining_hall_hollidays_menu"/>
                <menuitem
                    icon="STOCK_EXECUTE"
                    id="holiday_dining_hall_year_wizard_mi"
                    action="training.holiday_year_wizard_act"
                    parent="training_dining_hall_hollidays_menu"/>
                <menuitem
                    icon="STOCK_EXECUTE"
                    name="School Calendar Year Generator"
                    id="training_dining_hall_calendar_school_year_menu"
                    action="training_multi_school.training_calendar_school_year_action"
                    parent="training_dining_hall_hollidays_menu"/>

    </data>
</openerp>
